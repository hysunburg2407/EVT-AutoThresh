Core calculation functions live here
